<!--
ç²’ã®å‹•ãã‚’ã‚‚ã£ã¨è‡ªç„¶ã«ã—ãŸã‚Šã€é‡åŠ›ã‚„æ•£ä¹±åŠ¹æœã‚’è¿½åŠ  ã™ã‚‹æ”¹è‰¯ç‰ˆ
-->>
<html>
  <head>
    <meta charset="utf-8">
    <title>ã‚†ã£ãã‚Šæ¶ˆãˆã‚‹è‡ªç„¶ãªç²’ï¼ˆé‡åŠ›ãƒ»æ•£ä¹±ãƒ»é•·å¯¿å‘½ï¼‰</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>body{margin:0;overflow:hidden;}</style>

    <script>
      AFRAME.registerComponent('slow-dissolve', {
        init: function () {
          const el = this.el;

          // èª¿æ•´ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆã“ã“ã‚’å¤‰ãˆã‚Œã°æŒ™å‹•ã‚’ç°¡å˜ã«ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã§ãã¾ã™ï¼‰
          const PARTICLE_COUNT = 50;
          const DURATION_MS = 90000;      // ç²’ã®ç·å¯¿å‘½ï¼ˆmsï¼‰ â† ã“ã‚Œã‚’å¤§ããã™ã‚‹ã¨é•·ãæ®‹ã‚‹
          const FADE_START_MS = 3000;    // ä½•mså¾Œã‹ã‚‰ãƒ•ã‚§ãƒ¼ãƒ‰é–‹å§‹ã™ã‚‹ã‹ï¼ˆmsï¼‰
          const GRAVITY = -0.12;         // é‡åŠ›ï¼ˆè² ã®å€¤ï¼‰ã€‚çµ¶å¯¾å€¤ã‚’å°ã•ãã™ã‚‹ã¨ã‚†ã£ãã‚Šè½ã¡ã‚‹
          
          for (let i = 0; i < PARTICLE_COUNT; i++) {
            const particle = document.createElement('a-sphere');

            // // åˆæœŸä½ç½®ï¼ˆä¸­å¿ƒä»˜è¿‘ï¼‰
            // const startX = (Math.random() - 0.5) * 0.12;
            // const startZ = (Math.random() - 0.5) * 0.12;
            // const startY = 0.04 + Math.random() * 0.04;
            // ğŸ“ ãƒãƒ¼ã‚«ãƒ¼å†…ã®ç¯„å›²ã«é™å®šï¼ˆ-0.45ã€œ0.45ï¼‰
            const startX = (Math.random() - 0.5) * 0.9;
            const startZ = (Math.random() - 0.5) * 0.9;
            const startY = 0.02;

            // // åˆé€Ÿï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰
            // const vx = (Math.random() - 0.5) * 0.25;
            // const vy = 0.18 + Math.random() * 0.25; // ä¸Šæ–¹å‘ã®åˆé€Ÿï¼ˆå°ã•ã‚ã«ã—ã¦æ»ç©ºæ™‚é–“ã‚’å»¶ã°ã™ï¼‰
            // const vz = (Math.random() - 0.5) * 0.25;
            // æ‹¡æ•£æ–¹å‘ï¼ˆãƒãƒ¼ã‚«ãƒ¼é¢ã®ä¸Šã«å‘ã‹ã£ã¦ãµã‚“ã‚ã‚Šï¼‰
            const vx = (Math.random() - 0.5) * 0.1; // æ¨ªæ–¹å‘å°ã•ã‚
            const vy = 0.15 + Math.random() * 0.1;  // ã‚†ã‚‹ã‚„ã‹ã«ä¸Šæ˜‡
            const vz = (Math.random() - 0.5) * 0.1;

            particle.setAttribute('position', `${startX} ${startY} ${startZ}`);
            particle.setAttribute('radius', `${0.018 + Math.random()*0.01}`);
            particle.setAttribute('color', '#FFC0CB');
            particle.setAttribute('material', 'opacity: 1; transparent: true;');

            el.appendChild(particle);

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆrequestAnimationFrameï¼‰
            const startTime = performance.now();
            let rafId = null;

            const animate = (now) => {
              const elapsed = now - startTime; // ms
              const t = elapsed / 1000; // s

              // ç‰©ç†ã£ã½ã„ä½ç½®
              const x = startX + vx * t;
              const y = startY + vy * t + 0.5 * GRAVITY * t * t;
              const z = startZ + vz * t;

              // é¢¨ã®æºã‚‰ãï¼ˆå°ã•ãï¼‰
              const swayX = Math.sin(t * 6 + i) * 0.01;
              const swayZ = Math.cos(t * 5 + i) * 0.01;

              particle.setAttribute('position', `${x + swayX} ${y} ${z + swayZ}`);

              // // ãƒ•ã‚§ãƒ¼ãƒ‰ï¼ˆFADE_START_MS ã‹ã‚‰ DURATION_MS ã¾ã§ç·šå½¢ã§ä¸‹ã’ã‚‹ï¼‰
              // let opacity = 1;
              // if (elapsed >= FADE_START_MS) {
              //   const fadeElapsed = elapsed - FADE_START_MS;
              //   const fadeDuration = Math.max(DURATION_MS - FADE_START_MS, 1);
              //   opacity = Math.max(1 - (fadeElapsed / fadeDuration), 0);
              // }
              // particle.setAttribute('material', 'opacity', opacity);
              // å¾ã€…ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
              const opacity = Math.max(1 - elapsed / DURATION_MS, 0);
              particle.setAttribute('material', 'opacity', opacity);

              // // çµ‚äº†æ¡ä»¶ï¼šå¯¿å‘½ã‚’è¶…ã™ã‹ã€ã‹ãªã‚Šä¸‹ã«è½ã¡ãŸã‚‰æ¶ˆã™
              // if (elapsed < DURATION_MS && y > -0.5) {
              //   rafId = requestAnimationFrame(animate);
              // } else {
              //   // è¦ç´ ãŒã¾ã ã‚ã‚‹ãªã‚‰å‰Šé™¤ï¼ˆå®‰å…¨ã®ãŸã‚ try/catchï¼‰
              //   try { el.removeChild(particle); } catch(e){ }
              //   if (rafId) cancelAnimationFrame(rafId);
              // }
              // ãƒãƒ¼ã‚«ãƒ¼å†…ã‹ã‚‰å‡ºãªã„ã‚ˆã†åˆ¶é™
              if (
                elapsed < DURATION_MS &&
                y > 0 &&
                Math.abs(x) < 0.5 &&
                Math.abs(z) < 0.5
              ) {
                requestAnimationFrame(animate);
              } else {
                el.removeChild(particle);
              }              
            };

            rafId = requestAnimationFrame(animate);
          }
        }
      });
    </script>
  </head>

  <body>
    <a-scene embedded arjs>
      <a-marker preset="hiro">
        <!--<a-entity slow-dissolve></a-entity>-->
        <!-- ğŸ’  ç²’ãŒãƒãƒ¼ã‚«ãƒ¼å†…ã§èˆã† -->
        <a-entity marker-contained-particles></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
    <!--<p style="position:fixed;left:10px;top:10px;background:#fff;padding:6px;">â³ æ¶ˆãˆã‚‹ã®ã‚’ã‚†ã£ãã‚Šã«èª¿æ•´æ¸ˆã¿</p>-->
    <p style="position:fixed;left:10px;top:10px;background:#fff;padding:6px;">â³ ç›®ã‚’å‡ã‚‰ã™ã¨ã€ãƒ“ãƒ¼ã‚«ãƒ¼ã®ä¸­ã§ã¯ã“ã‚“ãªã“ã¨ãŒèµ·ãã¦ã„ãŸï¼ï¼</p>
  </body>
</html>
<!--
<!DOCTYPE html>
<html>
  <head>
    <title>ç²‰ãŒè‡ªç„¶ã«æ•£ã£ã¦æ¶ˆãˆã‚‹ï¼ˆé‡åŠ›ãƒ»æ‹¡æ•£åŠ¹æœä»˜ãï¼‰</title>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>

    <script>
      AFRAME.registerComponent('natural-dissolve', {
        init: function () {
          const el = this.el;

          for (let i = 0; i < 100; i++) {
            const particle = document.createElement('a-sphere');

            // åˆæœŸä½ç½®ï¼ˆä¸­å¿ƒä»˜è¿‘ã«ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ï¼‰
            const startX = (Math.random() - 0.5) * 0.1;
            const startZ = (Math.random() - 0.5) * 0.1;
            const startY = 0.05 + Math.random() * 0.05;

            // é€Ÿåº¦ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆæ‹¡æ•£æ–¹å‘ï¼‰
            const vx = (Math.random() - 0.5) * 0.3;
            const vy = 0.3 + Math.random() * 0.3;  // ä¸Šæ–¹å‘ã®åˆé€Ÿ
            const vz = (Math.random() - 0.5) * 0.3;

            // é‡åŠ›åŠ é€Ÿåº¦
            const gravity = -0.25;

            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è¨­å®š
            particle.setAttribute('position', `${startX} ${startY} ${startZ}`);
            particle.setAttribute('radius', '0.02');
            particle.setAttribute('color', '#FFC0CB'); // ãƒ”ãƒ³ã‚¯ç³»ã«å¤‰æ›´
            particle.setAttribute('material', 'opacity: 1; transparent: true;');

            // è‡ªç„¶ãªå‹•ãã‚’å†ç¾ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
            let time = 0;
            const duration = 10000;
            const interval = 30; // ãƒŸãƒªç§’

            const moveInterval = setInterval(() => {
              time += interval;

              // ã‚·ãƒ³ãƒ—ãƒ«ãªç‰©ç†é¢¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
              const t = time / 1000; // ç§’å˜ä½
              const x = startX + vx * t;
              const y = startY + vy * t + 0.5 * gravity * t * t;
              const z = startZ + vz * t;

              // å°‘ã—é¢¨ã§æºã‚‰ãã‚ˆã†ã«
              const swayX = Math.sin(t * 6 + i) * 0.01;
              const swayZ = Math.cos(t * 5 + i) * 0.01;

              particle.setAttribute('position', `${x + swayX} ${y} ${z + swayZ}`);

              // é€æ˜åº¦ã‚’æ¸›ã‚‰ã™
              const opacity = Math.max(1 - t / 3, 0);
              particle.setAttribute('material', 'opacity', opacity);

              // ä¸‹ã«è½ã¡ãã£ãŸã‚‰å‰Šé™¤
              if (y < 0 || time > duration) {
                el.removeChild(particle);
                clearInterval(moveInterval);
              }
            }, interval);

            el.appendChild(particle);
          }
        }
      });
    </script>
  </head>

  <body>
    <a-scene embedded arjs>
      <a-marker preset="hiro">
        <a-entity natural-dissolve></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <p style="position: fixed; top: 10px; left: 10px; background: white; padding: 5px;">
      ğŸŒ¸ ç²‰ãŒè‡ªç„¶ã«æ•£ã£ã¦è½ã¡ã‚‹ï¼ˆé‡åŠ›ãƒ»æ‹¡æ•£åŠ¹æœä»˜ãï¼‰
    </p>
  </body>
</html>
-->


<!--ä»¥ä¸‹å…ƒã‚½ãƒ¼ã‚¹ã€ã¡ã‚‡ã£ã¨ã„ã˜ã£ã¦ã¿ãŸã‘ã©
<!DOCTYPE html>
<html>
  <head>
    <title>ç²‰ãŒå¤§ããæº¶ã‘ã¦åºƒãŒã‚‹æ§˜å­ï¼ˆè¦–èªæ€§å¼·åŒ–ï¼‰</title>
    <meta charset="utf-8">
    <!-- Webä¸Šã§3Dãƒ»VR/ARã‚’ç°¡å˜ã«æ‰±ãˆã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ --><!--
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- ãƒãƒ¼ã‚«ãƒ¼èªè­˜å‹ARã‚’Webä¸Šã§å®Ÿç¾ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª --><!--
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
    <script>
      // ç²‰ã®ç²’ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®çƒï¼‰ã‚’ç”Ÿæˆã—ã€é£›ã³æ•£ã£ã¦æ¶ˆãˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹
      AFRAME.registerComponent('dissolve-particles', {
        init: function () {
          const el = this.el;
          for (let i = 0; i < 40; i++) {
            const particle = document.createElement('a-sphere');
            //const particle = document.querySelector('#particle');
            
            const startX = (Math.random() - 0.5) * 0.15;
            const startZ = (Math.random() - 0.5) * 0.15;
            const endX = startX + (Math.random() - 0.5) * 0.5;
            const endY = 0.8 + Math.random() * 0.3;
            const endZ = startZ + (Math.random() - 0.5) * 0.5;

            particle.setAttribute('position', `${startX} 0.1 ${startZ}`);
            particle.setAttribute('radius', '0.015'); // å¤§ãã‚ï¼ˆ0.03ï¼‰ã®åŠåˆ†ã«
            particle.setAttribute('color', '#FF69B4');  // ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆ#FFA500ï¼‰ã‹ã‚‰ãƒ”ãƒ³ã‚¯
            particle.setAttribute('material', 'opacity: 1; transparent: true;');

            particle.setAttribute('animation__move', `
              property: position;
              to: ${endX} ${endY} ${endZ};
              dur: 4000;
              easing: easeOutCubic;
              loop: false;
            `);

            particle.setAttribute('animation__fade', `
              property: material.opacity;
              to: 0;
              dur: 10000; // 4000ã‹ã‚‰å¤‰æ›´
              easing: linear;
              loop: false;
            `);

            el.appendChild(particle);
          }
        }
      });
    </script>
  </head>
  <body>
    <!-- Hiroãƒãƒ¼ã‚«ãƒ¼ã‚’èªè­˜ã™ã‚‹ã¨ã€ãã®ä½ç½®ã«<a-entity dissolve-particles>ãŒè¡¨ç¤ºã•ã‚Œã‚‹ --><!--
    <a-scene embedded arjs>
      <a-marker preset="hiro">
        <a-entity dissolve-particles></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
    <p style="position: fixed; top: 10px; left: 10px; background: white; padding: 5px;">
      ğŸ§ª å¤§ãã‚ã®ç²‰ãŒãµã‚ã£ã¨åºƒãŒã‚‹ï¼ˆè¦–èªæ€§å¼·åŒ–ï¼‰
    </p>
  </body>
</html>
-->
