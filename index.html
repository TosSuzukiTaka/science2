<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hiroãƒãƒ¼ã‚«ãƒ¼å†…ã§ç²‰ãŒèˆã†</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>body { margin: 0; overflow: hidden; }</style>

    <script>
      AFRAME.registerComponent('marker-contained-particles', {
        init: function () {
          // èª¿æ•´ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆã“ã“ã‚’å¤‰ãˆã‚Œã°æŒ™å‹•ã‚’ç°¡å˜ã«ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã§ãã¾ã™ï¼‰
          const el = this.el;
          const PARTICLE_COUNT = 50;
          const DURATION_MS = 90000;      // ç²’ã®ç·å¯¿å‘½ï¼ˆmsï¼‰ â† ã“ã‚Œã‚’å¤§ããã™ã‚‹ã¨é•·ãæ®‹ã‚‹
          // const FADE_START_MS = 3000;    // ä½•mså¾Œã‹ã‚‰ãƒ•ã‚§ãƒ¼ãƒ‰é–‹å§‹ã™ã‚‹ã‹ï¼ˆmsï¼‰
          const GRAVITY = -0.15;         // é‡åŠ›ï¼ˆè² ã®å€¤ï¼‰ã€‚çµ¶å¯¾å€¤ã‚’å°ã•ãã™ã‚‹ã¨ã‚†ã£ãã‚Šè½ã¡ã‚‹

          for (let i = 0; i < PARTICLE_COUNT; i++) {
            const particle = document.createElement('a-sphere');

            // ğŸ“ ãƒãƒ¼ã‚«ãƒ¼å†…ã®ç¯„å›²ã«é™å®šï¼ˆ-0.45ã€œ0.45ï¼‰
            const startX = (Math.random() - 0.5) * 0.9;
            const startZ = (Math.random() - 0.5) * 0.9;
            const startY = 0.02;

            // æ‹¡æ•£æ–¹å‘ï¼ˆãƒãƒ¼ã‚«ãƒ¼é¢ã®ä¸Šã«å‘ã‹ã£ã¦ãµã‚“ã‚ã‚Šï¼‰
            const vx = (Math.random() - 0.5) * 0.1; // æ¨ªæ–¹å‘å°ã•ã‚
            const vy = 0.15 + Math.random() * 0.1;  // ã‚†ã‚‹ã‚„ã‹ã«ä¸Šæ˜‡
            const vz = (Math.random() - 0.5) * 0.1;

            particle.setAttribute('position', `${startX} ${startY} ${startZ}`);
            particle.setAttribute('radius', '0.02');
            particle.setAttribute('color', '#FFC0CB');
            particle.setAttribute('material', 'opacity: 1; transparent: true;');

            el.appendChild(particle);

            const startTime = performance.now();

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆrequestAnimationFrameï¼‰
            const animate = (now) => {
              const elapsed = now - startTime;
              const t = elapsed / 1000;

              // ç‰©ç†ã£ã½ã„ä½ç½®
              const x = startX + vx * t;
              const y = startY + vy * t + 0.5 * GRAVITY * t * t;
              const z = startZ + vz * t;

              // ğŸƒ è»½ã„æºã‚‰ã
              const swayX = Math.sin(t * 5 + i) * 0.02;
              const swayZ = Math.cos(t * 4 + i) * 0.02;

              particle.setAttribute('position', `${x + swayX} ${y} ${z + swayZ}`);

              // å¾ã€…ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
              const opacity = Math.max(1 - elapsed / DURATION_MS, 0);
              particle.setAttribute('material', 'opacity', opacity);

              // ãƒãƒ¼ã‚«ãƒ¼å†…ã‹ã‚‰å‡ºãªã„ã‚ˆã†åˆ¶é™
              if (
                elapsed < DURATION_MS &&
                y > 0 &&
                Math.abs(x) < 0.5 &&
                Math.abs(z) < 0.5
              ) {
                requestAnimationFrame(animate);
              } else {
                el.removeChild(particle);
              }
            };

            requestAnimationFrame(animate);
          }
        }
      });
    </script>
  </head>

  <body>
    <a-scene embedded arjs>
      <a-marker preset="hiro">
        <!-- ğŸ’  ç²’ãŒãƒãƒ¼ã‚«ãƒ¼å†…ã§èˆã† -->
        <a-entity marker-contained-particles></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
    <p style="position:fixed;top:10px;left:10px;background:#fff;padding:5px;">
      ğŸ§ª ãªã‚“ã¨ï¼ãƒ“ãƒ¼ã‚«ãƒ¼ã®ä¸­ã§ã¯ã“ã‚“ãªã“ã¨ãŒèµ·ãã¦ã„ãŸï¼
    </p>
  </body>
</html>